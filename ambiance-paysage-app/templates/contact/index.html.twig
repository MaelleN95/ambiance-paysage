{% extends 'base.html.twig' %}

{% block title %}Contact{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {# Choices.js CSS #}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <link rel="stylesheet" href="{{ asset('styles/contact.css') }}">
<style>
form div {
    display:flex;
    flex-direction: column;
    margin-top: 10px;
}

.duo {
    display: flex;
    flex-direction: row;
    gap: 20px;
}

.duo > div {
    flex: 1;
}

input[type="text"],
input[type="email"],
input[type="tel"],
textarea,
select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
    font-family: inherit;
    transition: all 0.2s;
    box-sizing: border-box;
}

input:focus,
textarea:focus,
select:focus {
    border-color: var(--green);
    box-shadow: 0 0 5px #c1e17177;
    outline: none;
}

textarea {
    min-height: 120px;
    resize: vertical;
}

label {
    margin-bottom: 5px;
    font-weight: 500;
}

::placeholder {
    color: #aaa;
    opacity: 1;
}

.submit-container {
    display: flex;
    justify-content: center;
    flex-direction:row;
    margin: 20px 0;
}

button[type="submit"] {
    display:block;
    padding: 10px 30px;
    background-color: transparent;
    color: var(--black);
    border: 3px solid var(--green);
    border-radius: 4px;
    font-family: Open Sans, sans-serif;
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.3s;
}

button[type="submit"]:hover {
    background-color: var(--green);
}

.choices {
    margin:0;
}

.choices__inner {
    margin:0;
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ccc;
    background: white;
    border-radius: 4px;
    font-size: 16px;
    font-family: inherit;
    transition: all 0.2s;
    box-sizing: border-box;
}

.choices__input {
    background: white;
}

.choices__input:focus {
    border-color: none;
    box-shadow:none;
    outline: none;
}

.choices__input:focus ~ .choices__inner {
    background:red;
}


</style>
{% endblock %}

{% block body %}
<section id="contact-section">
    <div class="max-width-container">
        <h1>Contact</h1>

        {{ form_start(form) }}
            {{ form_row(form.company) }}
            <div class="duo">
                {{ form_row(form.firstName) }}
                {{ form_row(form.lastName) }}
            </div>
            {{ form_row(form.address) }}
            <div class="duo">
                {{ form_row(form.phone) }}
                {{ form_row(form.email) }}
            </div>
            {{ form_row(form.service) }}
            {{ form_row(form.message) }}
            <div class="submit-container">
                <button type="submit">Envoyer</button>
            </div>
        {{ form_end(form) }}
    </div>
</section>

{# Choices.js JS #}
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Choices.js pour le champ service ---
    const serviceSelect = document.querySelector('.choices-service');
    if (serviceSelect) {
        new Choices(serviceSelect, {
            removeItemButton: true,
            placeholderValue: 'Choisir un ou plusieurs services',
            searchEnabled: true,
        });
    }

    // --- Autocomplete adresse avec API Adresse (France uniquement) ---
    const addressInput = document.getElementById('contact_address');
    if (!addressInput) return;

    const dropdown = document.createElement('ul');
    {# dropdown.style.position = 'absolute';
    dropdown.style.background = 'white';
    dropdown.style.border = '1px solid #ccc';
    dropdown.style.listStyle = 'none';
    dropdown.style.padding = '5px';
    dropdown.style.margin = '0';
    dropdown.style.width = addressInput.offsetWidth + 'px';
    dropdown.style.zIndex = 1000; #}
    addressInput.parentNode.style.position = 'relative';
    addressInput.parentNode.appendChild(dropdown);

    addressInput.addEventListener('input', async () => {
        const query = addressInput.value.trim();
        if (query.length < 3) {
            dropdown.innerHTML = '';
            return;
        }

        try {
            const response = await fetch(
                `https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(query)}&limit=5`
            );
            const data = await response.json();

            dropdown.innerHTML = '';
            data.features.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item.properties.label; // adresse complÃ¨te propre
                li.style.cursor = 'pointer';
                li.style.padding = '3px 5px';
                li.addEventListener('click', () => {
                    addressInput.value = li.textContent;
                    dropdown.innerHTML = '';
                });
                dropdown.appendChild(li);
            });
        } catch (err) {
            console.error(err);
            dropdown.innerHTML = '';
        }
    });

    document.addEventListener('click', (e) => {
        if (e.target !== addressInput) dropdown.innerHTML = '';
    });
});
</script>

<style>
/* Style simple pour les tags Choices.js */
.choices__list--multiple .choices__item {
    background-color: #007bff;
    color: white;
    border-radius: 3px;
    padding: 2px 6px;
}
</style>
{% endblock %}
