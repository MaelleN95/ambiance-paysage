{% extends 'base.html.twig' %}

{% block title %}Contact{% endblock %}

{% block body %}
<h1>Contact</h1>

{{ form_start(form) }}
    {{ form_row(form.company) }}
    {{ form_row(form.firstName) }}
    {{ form_row(form.lastName) }}
    {{ form_row(form.address) }}
    {{ form_row(form.phone) }}
    {{ form_row(form.email) }}
    {{ form_row(form.service) }}
    {{ form_row(form.message) }}
    <button type="submit">Envoyer</button>
{{ form_end(form) }}

{# Choices.js CSS #}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

{# Choices.js JS #}
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Choices.js pour le champ service ---
    const serviceSelect = document.querySelector('.choices-service');
    if (serviceSelect) {
        new Choices(serviceSelect, {
            removeItemButton: true,
            placeholderValue: 'Choisir un ou plusieurs services',
            searchEnabled: true,
        });
    }

    // --- Autocomplete adresse avec API Adresse (France uniquement) ---
    const addressInput = document.getElementById('contact_address');
    if (!addressInput) return;

    const dropdown = document.createElement('ul');
    {# dropdown.style.position = 'absolute';
    dropdown.style.background = 'white';
    dropdown.style.border = '1px solid #ccc';
    dropdown.style.listStyle = 'none';
    dropdown.style.padding = '5px';
    dropdown.style.margin = '0';
    dropdown.style.width = addressInput.offsetWidth + 'px';
    dropdown.style.zIndex = 1000; #}
    addressInput.parentNode.style.position = 'relative';
    addressInput.parentNode.appendChild(dropdown);

    addressInput.addEventListener('input', async () => {
        const query = addressInput.value.trim();
        if (query.length < 3) {
            dropdown.innerHTML = '';
            return;
        }

        try {
            const response = await fetch(
                `https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(query)}&limit=5`
            );
            const data = await response.json();

            dropdown.innerHTML = '';
            data.features.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item.properties.label; // adresse complÃ¨te propre
                li.style.cursor = 'pointer';
                li.style.padding = '3px 5px';
                li.addEventListener('click', () => {
                    addressInput.value = li.textContent;
                    dropdown.innerHTML = '';
                });
                dropdown.appendChild(li);
            });
        } catch (err) {
            console.error(err);
            dropdown.innerHTML = '';
        }
    });

    document.addEventListener('click', (e) => {
        if (e.target !== addressInput) dropdown.innerHTML = '';
    });
});
</script>

<style>
/* Style simple pour les tags Choices.js */
.choices__list--multiple .choices__item {
    background-color: #007bff;
    color: white;
    border-radius: 3px;
    padding: 2px 6px;
}
</style>
{% endblock %}
